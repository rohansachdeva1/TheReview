{% extends 'base.html' %}

{% block content %}


{% load static %}
    <link rel="stylesheet" type="text/css" href="{% static 'view_profile.css' %}">

<style>
.metrics-container {
    display: flex;
    gap: 10px;
    align-items: center;
    margin-left: 10px;
}

.metric {
    text-align: center;
}

.metric-value {
  font-size: 24px;
  font-weight: bold;
}

.metric-label {
  font-size: 14px;
  color: #888;
}

</style>

{% if request.user.id == user.id %}
    <h1 class="profile-heading">Welcome, @{{ user.username }}!</h1>
{% else %}
    <h1 class="profile-heading">Welcome to @{{ user.username }}'s Profile</h1>
{% endif %}


<div class="container-fluid">

    <!-- Main Profile Details -->
    <div>
        
        <div class="metrics-container">
            {% if user.profile.profile_image %}
                <img src="{{ user.profile.profile_image.url }}" width="100" height="100" class="custom-circle">
            {% endif %}
            <div class="metric">
                <div class="metric-value">{{ user.profile.reviewed }}</div>
                <div class="metric-label">Reviewed</div>
            </div>
            <div class="metric">
                <div class="metric-value">{{ user.profile.avg_rating }}</div>
                <div class="metric-label">Average Rating</div>
            </div>
        </div>
        {% if user.profile.bio %}
            <div class="profile-message">
                <p>Bio: {{ user.profile.bio }}</p>
            </div>
        {% endif %}

        <!-- Check following and followers for testing -->
        <!-- <p>Following:</p>
        {% for following in user.profile.follows.all %}
            <a href="{% url 'view_profile' following %}">
            <p>{{ following }}</p>
            </a>
        {% endfor%}

        <p>Followed by:</p>
        {% for following in user.profile.followed_by.all %}
            <a href="{% url 'view_profile' following %}">
            <p>{{ following }}</p>
            </a>
        {% endfor%} -->

        <!-- Follow / Unfollow buttons on other user's profiles -->
        {% if request.user.id != user.id %}
            {% if request.user.profile in user.profile.followed_by.all %}
                <div>
                    <a href="{% url 'unfollow' user.id %}" class="btn btn-outline-danger">Unfollow</a>
                </div>
            {% else %}
                <div>
                    <a href="{% url 'follow' user.id %}" class="btn btn-outline-success">Follow</a>
                </div>
            {% endif%}
        {% endif %}
        
    </div>

    <!-- User Playlists -->
    {% if user.playlists %}
        <h1 class="profile-heading">Playlists</h1>
        <div>
            {% for playlist in user.playlists.all %}
                <a href="{% url 'view_playlist' playlist.id %}" class="btn btn-outline-primary">{{ playlist.medium }} Playlist</a>
            {% endfor %}
        </div>
    {% endif %}

    <!-- User Reviews -->
    <div>
        <h1 class="profile-heading">Reviews</h1>
        <div class="container-fluid">
            {% if user.reviews %}
            <div class="row">
                {% for review in reviews %}
                <div class="col-md-4">
                    {% include 'reviews/review_tile.html' with review=review %}
                </div>
                  {% if forloop.counter|divisibleby:3 and not forloop.last %}
                    </div><div class="row" style="margin-top: 15px">
                  {% endif %}
                {% endfor %}
              </div>
            {% else %}
                <h4>No Reviews Available</h4>
            {% endif %}
        </div>
    </div>
    </br>

    <!-- List of Followers-->
    <h4>Following</h4>
    <div class="row">
        {% for following in user.profile.follows.all %}
        <div class="col-md-3">
            {% include 'users/profile_tile.html' with user=following.user %}
        </div>
        {% if forloop.counter|divisibleby:4 and not forloop.last %}
            </div><div class="row">
        {% endif %}
        {% endfor %}
    </div>
    </br>

    <!-- Log Out Functionality -->
    {% if request.user.id == user.id %}
    <div>
        <a href="{% url 'logout' %}" class="btn btn-outline-danger">Log Out</a>
    </div>
    {% endif %}
    
</br>
</br>
</div>
{% endblock %}